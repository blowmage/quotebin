<!DOCTYPE html>
<html>
<head>
  <title>Quote Bin</title>
  <link rel="shortcut icon" href="assets/favicon.ico" />
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
  <script type="text/javascript" src="//use.typekit.net/iky2ouv.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
</head>
<body class="page">


  <% flash.each do |type, msg| %>
    <div class="alert alert_sticky-top js-alert alert__<%= type %>">
      <p class="alert__message"><%= msg %></p>
      <a class="button button_close js-alert-close"><i class="icon icon_close_white"></i></a>
    </div>
  <% end %>

  <aside class="page__sidebar">
    <header class="page__branding">
      <a  href="<%= root_path %>" class="page__logo icon icon__logo"></a>

      <% if signed_in?(:user) -%>
        <div class="fr mlm">
          <%= link_to 'Add Quote', new_quote_path, class: "button button_inline button_opaque_black hidden m_show_inline-block" %>
        </div>
      <% else -%>
      <% end -%>

      <div class="page__branding__action js-page-branding-action">
        <a class="js-user-box-toggle button button_opaque_white button_inline state_active" href="#">
          <i class="icon icon_user"></i>
          <span class="dropdown__arrow">&#x25BC;</span>
        </a>
        <a class="js-user-box-toggle button button_inline" href="#">
          <i class="icon icon_user"></i>
          <span class="dropdown__arrow">&#x25B2;</span>
        </a>
      </div>
    </header>
    <a href="#" class="inverted js-add-quote">create</a>


    <% if signed_in?(:user) -%>
    <section class="user-box js-user-box">
      <div class="user-box__main">
        <figure class="figure figure_avatar figure_30 user-box__avatar">
          <a href="<%= profile_path %>"><%= gravatar_image_tag(current_user.email, :alt => current_user.name, class: 'figure__image', gravatar: {size: 32}) %></a>
        </figure>
        <div class="page__sidebar__user user-box__name">
          <%= link_to current_user.name, profile_path, class: "inverted user-box__name-link b" %>
          <%= link_to "Sign Out", destroy_user_session_path, class: "inverted user-box__name-link opacity_5", method: :delete,
                                                               data:   { :confirm => "You sure?" } %>
        </div>
      </div>
      <div class="user-box__metadata button-bar button-bar_3">
        <a class="button button_opaque_white button_label-hover" href="<%= quotes_path %>">
          <i class="icon icon_quote_white icon_no-text"></i>
          <span class="button__title">My Quotes</span>
        </a>
        <a class="button button_opaque_white button_label-hover" href="">
          <i class="icon icon_like_white icon_no-text"></i>
          <span class="button__title">My Likes</span>
        </a>
        <a class="button button_opaque_white button_label-hover" href="">
          <i class="icon icon_tag_white icon_no-text"></i>
          <span class="button__title">My Tags</span>
        </a>
      </div>

      <%= link_to 'Add Quote', new_quote_path, class: "button mtm hidden" %>
    </section>
    <% else -%>
      <section class="user-box js-user-box">
         <div class="user-box__metadata button-row">
          <div class="button-wrapper">
            <%= link_to "Sign Up", new_user_registration_path, class: "button button_white button_sign-up" %>
          </div>
          <div class="button-wrapper">
            <%= link_to "Sign In", new_user_session_path, class: "button button_white" %>
          </div>
        </div>
      </section>
    <% end -%>

    <section class="list_trending-tags list">
      <header class="list__header mbs">Trending Tags</header>
        <ul class="list__body">
          <li class="list__item"><a href="#">Ridiculus</a></li>
          <li class="list__item"><a href="#">Ipsum Mollis</a></li>
          <li class="list__item"><a href="#">Bibendum Purus</a></li>
          <li class="list__item"><a href="#">Risus Ridiculus</a></li>
          <li class="list__item"><a href="#">Venenatis Sem</a></li>
          <li class="list__item"><a href="#">Pellentesque Tellus</a></li>
          <li class="list__item"><a href="#">Vulputate</a></li>
          <li class="list__item"><a href="#">Parturient</a></li>
          <li class="list__item"><a href="#">Dapibus</a></li>
          <li class="list__item"><a href="#">Inceptos</a></li>
        </ul>
      </header>
    </section>
  </aside>

  <div class="page__main">
    <header class="page__search page__main__header">
      <%= form_tag("/search", :method => "get") do %>
        <%= text_field_tag(:q, "", placeholder: "Search Or Add Quotes",
                                   data: { autocomplete_source: search_autocomplete_path },
                                   class: "input_text_main-search input_text js-main-search") %>
        <% end %>
    </header>

    <%= yield %>
  </div>

  <!-- Because I have 45 minutes to finish... -->
  <%- @new_quote = Quote.new %>
  <%= form_for @new_quote do |f| %>
    <div class="quote-creator js-quote-creator">
      <div class="quote-creator__wrapper">
        <section class="quote-creator__tags">
          <div class="input_text quote-creator__input">
            <%= f.text_field :tag_list, class: "quote-creator__input_tag", placeholder: "Tag your quote (optional)" %>
          </div>
        </section>
        <section class="quote-creator__quote">
          <%= f.text_area :quotation, class: "input_textarea quote-creator__input quote-creator__input_quote", placeholder:  "Enter your quote" %>
          <section class="quote-creator__markdown-tip">
            <header class="quote-creator__markdown-tip__header">You can use <a href="http://daringfireball.net/projects/markdown/syntax" class="b">Markdown</a> to format your quote.</header>
            <div class="quote-creator__markdown-tip__body list mbn">
              <header class="list__header b">We support:</header>
              <ul class="list__body">
                <li class="list__item"><span class="b">Lists</span> (1. numbered) (- bulleted)</li>
                <li class="list__item"><span class="b">Emphasis</span> (*bold*) (**italic**)</li>
                <li class="list__item"><a href="http://daringfireball.net/projects/markdown/syntax" class="b">How to use Markdown &raquo;</a></li>
              </ul>
            </div>
          </section>
        </section>
        <section class="quote-creator__meta">
          <section class="quote-creator__author">
            <%= f.text_field :author, class: "input_text quote-creator__input", placeholder: "Enter quote author (optional)" %>
          </section>
          <section class="quote-creator__source">
            <%= f.text_field :source, class: "input_text quote-creator__input", placeholder: "Enter quote source (optional)" %>
          </section>
        </section>
        <footer class="quote-creator__actions">
          <button class="button button_size_medium fl js-cancel-quote">Cancel</button>
          <%= f.submit "Add Quote", class: "button button_primary button_size_medium fr" %>
        </footer>
      </div>
    <% end %>
  </div>

  <script type="text/javascript">
    $(document).ready(function(){
      $(".js-main-search").focus(function() {
        $(this).parent().find(".js-list-main-search").fadeIn("fast");
      });
      $(".js-main-search").blur(function() {
        $(this).parent().find(".js-list-main-search").fadeOut("fast");
      });
      $(".js-user-box-toggle").click(function() {
        $(".js-user-box").toggleClass("state_active");
        $(".js-page-branding-action").find(".button").toggleClass("state_active");
      });
      $(".alert_sticky-top").addClass("state_active").delay(15000).queue(function() {
        $(this).addClass("state_falling");
        $(this).removeClass("state_active");
        $(this).dequeue();
      });
      $(".js-alert-close").click(function() {
        $(".js-alert").addClass("state_falling");
        $(".js-alert").removeClass("state_active");
      });
    });
    $(window).load(function(){
      var quote_title_count = $(".js-character-count").text().length;
      console.log(quote_title_count);
      if (quote_title_count > 350) {
        $(".js-character-count").addClass("quote-tile__title_size_normal");
      }
    });
  </script>
</body>
</html>